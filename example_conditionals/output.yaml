resources:
    - apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: conditional-app
      spec:
        replicas: 5
        selector:
            matchLabels:
                app: conditional-app
        template:
            metadata:
                labels:
                    app: conditional-app
            spec:
                containers:
                    - env:
                        - name: ENABLE_METRICS
                          value: "true"
                        - name: ENABLE_DEBUG
                          value: "false"
                      image: nginx:latest
                      name: app
                      ports:
                        - containerPort: 8080
                        - containerPort: 9090
                      resources:
                        limits:
                            cpu: 200m
                            memory: 256Mi
                        requests:
                            cpu: 100m
                            memory: 128Mi
                    - env:
                        - name: ENABLE_METRICS
                          value: "true"
                        - name: ENABLE_DEBUG
                          value: "false"
                      image: busybox:latest
                      name: sidecar
                      ports: []
                      resources: {}
    - apiVersion: v1
      kind: Service
      metadata:
        name: conditional-app-svc
      spec:
        ports:
            - name: http
              port: 80
              targetPort: 8080
            - name: metrics
              port: 9090
              targetPort: 9090
        selector:
            app: conditional-app
        type: ClusterIP
    - apiVersion: v1
      data:
        config.yaml: |
            application:
              name: conditional-app
              replicas: 5
              metrics:\n  enabled: true\n  port: 9090
              # debug disabled
        cpu-limit: 200m
        default-memory: 64Mi
        memory-limit: 256Mi
      kind: ConfigMap
      metadata:
        name: conditional-app-config
